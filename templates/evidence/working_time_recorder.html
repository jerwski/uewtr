{% extends 'base.html' %}
{% load bootstrap4 %}
{% load utility_tags %}

{% block title %}Add working time{% endblock %}


{% block content %}

<div class="container uk-bg-bisque">
  {% include 'blocks/header.html' %}
  <div class="row">
    <div class="col-3">
      <div class="uk-headline">
        <a href="{% url 'employee:employee_basicdata' %}">PRESENT EMPLOYEES</a>
      </div>
      <div class="uk-table-scroll-lg">
        <table class="uk-table">
          <tbody>
          {% for employee in employees %}
            <tr>
              {% if employee_id == employee.id %}
                <td class="text-right" id="{{ employee_id }}">{{ forloop.counter }}.</td><td><a class="font-weight-bold text-danger" href="{{ employee.work_employee_id }}">{{ employee }}</a></td>
              {% else %}
                <td class="text-right" id="{{ employee_id }}">{{ forloop.counter }}.</td><td><a class="font-weight-bold" href="{{ employee.work_employee_id }}">{{ employee }}</a></td>
              {% endif %}
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <div class="col-9">
      {% if worker.status %}
        <div class="uk-headline">
          WORK EVIDENCE FOR: {{ worker|upper }}
        </div>

        <div class="row">
          <div class="col-3 text-center">
            <div class="btn btn-group-sm btn-group-vertical" role="group">
              <a href="{% url 'evidence:working_time_recorder_add' employee_id %}" class="btn btn-sm btn-outline-light">Insert hours</a>
              <a href="{% url 'evidence:working_time_recorder_add' employee_id 12 %}" class="btn btn-sm btn-outline-info">6:00-12:00</a>
              <a href="{% url 'evidence:working_time_recorder_add' employee_id 14 %}" class="btn btn-sm btn-outline-success">6:00-14:00</a>
              <a href="{% url 'evidence:working_time_recorder_add' employee_id 16 %}" class="btn btn-sm btn-outline-primary">6:00-16:00</a>
              <a href="{% url 'evidence:working_time_recorder_add' employee_id 18 %}" class="btn btn-sm btn-outline-danger">6:00-18:00</a>
              <a href="{% url 'evidence:working_time_recorder_add' employee_id 6 %}" class="btn btn-sm btn-outline-dark font-weight-bold">22:00-6:00</a>
            </div>
          </div>
          <div class="col-9">
            <form action="{% url 'evidence:working_time_recorder_add' employee_id %}" method="POST">{% csrf_token %}
              {% bootstrap_field form.worker %}
              <div class="row mt-4">
                <div class='col-6'>
                  <div class="form-group">
                    {% bootstrap_field form.start_work size='small' label_class='text-primary font-weight-bold' placeholder='Select start of job...' %}
                  </div>
                </div>
                <div class='col-6'>
                  <div class="form-group">
                    {% bootstrap_field form.end_work size='small' label_class='text-primary font-weight-bold' placeholder='Select end of job...' %}
                  </div>
                </div>
              </div>
              <div class="row mt-3">
                <div class="col text-center">
                  <div class="btn btn-block mb-2">
                    <button type="submit" class="btn btn-lg btn-outline-success btn-block">Confirm</button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>

        {% if start_work > end_work %}
          <p class="uk-text-middle text-center">The start date is later than the end date! <span class="text-danger blink">Please correct it!</span></p>
        {% elif start_work >= end_work %}
          <p class="uk-text-middle text-center">The start date is the same like the end date! <span class="text-danger blink">Please correct it!</span></p>
        {% else %}
          {% if flag_work or flag_leave %}
            <p class="uk-text-middle text-center">Record for this day <span class="text-danger">{{ start_work|date:'l, d F Y' }}</span> is existing in database! <span class="text-danger blink">Please check it or correct!</span></p>
            <div class="row">
              <div class="col">
                <div class="btn-sm mb-2">
                  <a class="btn btn-outline-light btn-block font-weight-bold" href="/admin/">Admin Data Base</a>
                </div>
              </div>
            </div>
          {% else %}
            {% if jobhours %}
              <p class="text-center text-primary font-weight-bold">For <span class="text-danger">{{ worker }}</span> adding <span class="text-danger uk-text-middle blink">{{ jobhours|floatformat:2 }}</span> hour{{ total_hours|pluralize:'s' }}.<span class="text-danger"> Are you sure???</span></p>
              <p class="text-center uk-text-middle"><span>{{ start_work|date:'d M Y H:i' }} - {{ end_work|date:'d M Y H:i' }}</span></p>
              <div class="row mb-3">
                <div class="col-6 btn-sm">
                  <a href="{% url 'account:admin_site' %}" class="btn btn-sm btn-outline-dark btn-block">Back to the dashboard</a>
                </div>
                <div class="col-6 btn-sm">
                  {% if jobhours != 8 %}
                    <a href="{% url 'evidence:working_time_recorder_erase' employee_id start_work end_work %}" class="btn btn-sm btn-danger btn-block"><span class="font-weight-bold blink">Erase expanded jobhours ({{ jobhours|floatformat:2 }} hours)</span></a>
                  {% else %}
                    <a href="{% url 'evidence:working_time_recorder_erase' employee_id start_work end_work %}" class="btn btn-sm btn-danger btn-block"><span class="font-weight-bold blink">Erase standard jobhours ({{ jobhours|floatformat:2 }} hours)</span></a>
                  {% endif %}
                </div>
              </div>
            {% endif %}
          {% endif %}
        {% endif %}

        <div class="container">
          <div class="uk-evidence-box">
            <div class="row">
              <div class="col uk-evidence-headline d-flex justify-content-between">
                <div class="text-dark">Employee:</div>
                <div>{{ worker }}</div>
                <div class="text-dark">Rate:</div>
                <div>{{ rate|floatformat:2 }} PLN/h</div>
                <div class="text-dark">Hours:</div>
                <div>{{ total_hours|floatformat:2 }}</div>
              </div>
            </div>

            <div class="uk-evidence-data-box d-flex justify-content-between">
              <div class="text-dark">
                  Total work hours:<br>
                  Basic payment (100%):<br>
                  Saturday payment (100%):<br>
                  Overhours (50%):
              </div>
              <div class="text-danger">
                  {{ total_hours|floatformat:2 }} hour{{ total_hours|pluralize:'s' }}<br>
                  {{ basicpay|money_format }}<br>
                  {{ satpay|money_format }}<br>
                  {{ overhourspay|money_format }}
              </div>
              <div class="text-dark">
                  Brutto income:<br>
                  Leave payment (100%):<br>
                  Sunday payment (200%):<br>
                  Account payment:
              </div>
              <div class="text-danger">
                  {{ brutto|money_format }}<br>
                  {{ leavepay|money_format }}<br>
                  {{ sunpay|money_format }}<br>
                  {{ accountpay|money_format }}
              </div>
            </div>

            <div class="row">
              <div class="col uk-evidence-headline d-flex justify-content-around">
                <div class="text-dark">NETTO INCOME:</div>
                <div>{{ salary|money_format }}</div>
              </div>
            </div>
          </div>
        </div>

        {% if request.method == "GET" %}
          <div class="row text-center">
            <div class="col-2"></div>
            <div class="col-8 btn btn-block mb-2">
              <a href="{% url 'account:admin_site' %}" class="btn btn-lg btn-outline-dark btn-block">Back to the dashboard</a>
            </div>
            <div class="col-2"></div>
          </div>
        {% endif %}
      {% else %}
        {% if request.method == 'POST' %}
          <p class="text-center text-danger lead font-weight-normal bg-warning"><a class="text-danger" href="{% url 'evidence:working_time_recorder_add' employee_id %}">INCORRECT WORKING DATE</a></p>
          <div class="row text-center">
            <div class="col-1"></div>
            <div class="col-9 btn-sm mt-2">
              <p class="uk-text-middle">Please input correct <span class="text-danger">start-work</span> or <span class="text-danger">end-work</span> date. Both should be less or equal from today date.</p>
              <span class="uk-text-small">Today's date: {% now "l, jS F Y H:i" %}</span>
              <a href="{% url 'evidence:working_time_recorder_add' employee_id %}" class="btn btn-outline-info btn-block mt-5 blink">Back to the Working Time Recorder</a>
            </div>
            <div class="col-1"></div>
          </div>
        {% else %}
          <p class="text-center text-danger lead font-weight-normal bg-warning"><a class="text-danger" href="{% url 'employee:employee_basicdata' employee_id %}">EMPLOYEE IS DEACTIVATED</a></p>
          <div class="row text-center">
            <div class="col-1"></div>
            <div class="col-9 btn-sm mb-2">
              <p class="uk-text-middle">You can't add any working day for <span class="text-danger">{{ worker }}</span> because the employee is no longer employed or deactivated.</p>
              <a href="{% url 'employee:employee_basicdata' employee_id %}" class="btn btn-outline-info btn-block blink">Activate Employee</a>
            </div>
            <div class="col-1"></div>
          </div>
        {% endif %}
      {% endif %}
    </div>
  </div>
</div>


  <!-- blinkin after hideTime: seconds-->
  <script>
    $('.blink').each(function() {
      var elem = $(this);
      // count the blinks
      var count = 1;
      var intervalId = setInterval(function() {
         if (elem.css('visibility') == 'hidden') {
            elem.css('visibility', 'visible');
            // increment counter when showing to count # of blinks and stop when visible
            if (count++ === 3) {
              clearInterval(intervalId);
              }
          } else {
              elem.css('visibility', 'hidden');
          }
       }, 200);
    });
  </script>

{% endblock %}
