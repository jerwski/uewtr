{% extends 'base.html' %}
{% load static %}
{% load bootstrap4 %}
{% load utility_tags %}

{% block title %}Current data of employee{% endblock %}

{% block content %}

  <div class="container-fluid">
    <div class="row ml-3 mr-3 mt-2 bgbisque">
      <div class="col-sm-2 text-center">
        <a href="{% url 'account:admin_site' %}"><img src="{% static 'images/mainboard/logoUNI.png' %}" alt="UniLogo" width="58%"></a>
        <p class="footer text-secondary">Copyright UNIKOLOR Jerzy Wygonowski</p>
      </div>
      <div class="col-sm-8 mb-3 mt-2 text-center text-dark">
        <p class="h1 font-weight-normal">Working Time Recorder</p>
        <p class="text-info font-weight-bold font-italic">Application to handle employee working time in small business</p>
        {% include 'blocks/small_upper_buttons.html' %}
      </div>
      <div class="col-sm-2 mt-2 text-right">
        {% include 'blocks/alert.html' %}
      </div>
    </div>
    <div class="row ml-3 mr-3 mb-2 bgbisque">
      <div class="col-3">
        <p class="text-center text-danger lead font-weight-normal bg-warning"><a class="text-danger" href="{% url 'employee:employee_basicdata' %}">EMPLOYED WORKERS</a></p>

        <table class="table table-sm table-hover">
          <colgroup>
            <col span="1" style="width:5%">
            <col span="1" style="width:95%">
          </colgroup>
          <tbody>
          {% for employee in employees %}
            <tr>
              {% if employee_id == employee.id %}
                <td class="text-right" id="{{ employee_id }}">{{ forloop.counter }}.</td><td><a class="font-weight-bold text-danger" href="{{ employee.employee_complex_data }}">{{ employee }}</a></td>
              {% else %}
                <td class="text-right" id="{{ employee_id }}">{{ forloop.counter }}.</td><td><a class="font-weight-bold" href="{{ employee.employee_complex_data }}">{{ employee }}</a></td>
              {% endif %}
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="col-6">
        <p class="text-center text-danger lead font-weight-normal bg-warning">CURRENT DATA: {{ workerdata|upper }}</p>

        <form action="." method="POST">{% csrf_token %}
          <div class="row">
            <div class="col-8 mt-1">
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <div class="input-group-text bg-info">Select date</div>
                </div>
                {% bootstrap_field form.choice_date  form_group_class='form-inline' show_label=False %}
                <div class="input-group-append">
                  <button type="submit" class="btn btn-outline-success">Confirm</button>
                </div>
              </div>
            </div>
            <div class="col-4">
              <div class="btn-sm" role="group">
                <button id="btnGroupDropHolidays" type="button" class="btn btn-outline-danger btn-block dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Holidays in {{ choice_date|date:'Y' }} year </button>
                <div class="dropdown-menu" aria-labelledby="btnGroupDropHolidays">
                  <table class="table table-sm table-hover">
                    <tbody>
                    {% for key, value in holidays.items %}
                      <tr class="font-weight-light font-italic"><td class="text-right text-danger" width="55%">{{ key }}:</td><td class="text-left text-dark">{{ value|date:'d-m-Y (D)' }}</td></tr>
                    {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </form>

        {% if not workerdata.end_contract or workerdata.end_contract.year >= year and workerdata.end_contract.month >= month %}
          {% if rate %}
            <p class="text-center lead font-weight-normal bg-info">Kind of leave in {{ choice_date|date:'F Y' }}</p>
            <table class="table table-sm">
              <tbody class="text-center font-weight-normal">
                <tr>
                {% for key,value in month_leaves.items %}
                  <td>{{ key|capfirst }}: <em class="text-danger font-weight-bold">{{ value|floatformat:0 }} day{{ value|pluralize:'s' }}</em></td>
                {% endfor %}
                </tr>
                <tr class="text-danger text-justify">
                  <td style="width: 33%">
                  {% for d in sml %}
                    {% if d.leave_flag == 'unpaid_leave' %}
                      {{ d.leave_date|date:'j/m,' }}
                    {% endif %}
                  {% endfor %}
                  </td>
                  <td style="width: 33%">
                    {% for d in sml %}
                      {% if d.leave_flag == 'paid_leave' %}
                        {{ d.leave_date|date:'j/m,' }}
                      {% endif %}
                    {% endfor %}
                  </td>
                  <td style="width: 33%">
                    {% for d in sml %}
                      {% if d.leave_flag == 'maternity_leave' %}
                        {{ d.leave_date|date:'j/m,' }}
                      {% endif %}
                    {% endfor %}
                  </td>
                </tr>
              </tbody>
            </table>
            <p class="text-center lead font-weight-normal bg-info">All of leave in {{ choice_date|date:'Y' }} year</p>
            <table class="table table-sm">
              <tbody>
                <tr>
                {% for key,value in year_leaves.items %}
                  <td class="text-right">{{ key|capfirst }}</td><td class="text-danger font-weight-bold">{{ value|floatformat:0 }} day{{ value|pluralize:'s' }}</td>
                {% endfor %}
                </tr>
              </tbody>
            </table>

            <p class="text-center lead font-weight-normal bg-info">Total payment data for {{ choice_date|date:'F Y' }}&nbsp;&nbsp;&nbsp;RATE: <em class="text-white font-weight-bold">{{ rate|floatformat:2 }} PLN/h</em></p>

            <table class="table table-hover table-sm">
              <tbody>
                <tr>
                  <td class="text-right">Total hours:</td><td class="text-danger font-weight-bold"><a data-toggle="tooltip" data-html="true" title='<p class="text-justify">The total number of working hours is the sum of all hours worked in a given month, including Saturdays, Sundays and holidays but without days marked as paid vacation.</p>'>{{ total_hours|floatformat:2 }} hour{{ total_hours|pluralize:'s' }}</a></td>
                  <td class="text-right">Netto income:</td><td class="text-danger font-weight-bold"><a data-toggle="tooltip" data-html="true" title='<p class="text-justify">Net income results from the difference between gross income and the sum of advances granted.</p>'>{{ salary|money_format }}</a></td>
                </tr>
                <tr>
                  <td class="text-right">Basic payment (100%):</td><td class="text-danger font-weight-bold">{{ basicpay|money_format }}</td>
                  <td class="text-right">Leave payment (100%):</td><td class="text-danger font-weight-bold">{{ leavepay|money_format }}</td>
                </tr>
                <tr>
                  <td class="text-right">Saturday payment (100%):</td><td class="text-danger font-weight-bold">{{ satpay|money_format }}</td>
                  <td class="text-right">Sunday payment (200%):</td><td class="text-danger font-weight-bold">{{ sunpay|money_format }}</td>
                </tr>
                {% if overhourspay > 0 %}
                  <tr>
                    <td class="text-right">Account payment:</td><td class="text-danger font-weight-bold">{{ accountpay|money_format }}</td>
                    <td class="text-right">Overhours payment (50%):</td><td class="text-danger font-weight-bold">{{ overhourspay|money_format }}</td>
                  </tr>
                {% else %}
                  <tr>
                    <td class="text-right">Account payment:</td>
                    <td class="text-danger font-weight-bold">{{ accountpay|money_format }}</td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
            <p class="text-center text-white lead font-weight-bold bg-info">BRUTTO INCOME: {{ brutto|money_format }}</p>
          {% else %}
            <p class="text-center lead font-weight-normal">No data is available!</p>
          {% endif %}
        {% else %}
          <p class="text-center text-primary lead font-weight-normal">No data for {{ workerdata }} available because the employee is no longer employed.</p>
        {% endif %}
        <div class="row">
          <div class="col-6 btn">
            <a href="{% url 'account:admin_site' %}" class="btn btn-outline-dark btn-block">Back to the dashboard</a>
          </div>
          <div class="col-6 btn btn-group float-right" role="group">
            <a href="{% url 'account:exit' %}" class="btn btn-outline-danger">Exit</a>
            {% include 'blocks/plot_chart_modal.html' %}
            <a href="{% url 'logout' %}" class="btn btn-outline-info">Logout</a>
          </div>
        </div>
      </div>
      <div class="col-3 text-center">
        <p class="text-center text-danger lead font-weight-normal bg-warning"><a class="text-danger" href="{% url 'evidence:workhours_print' employee_id month year %}">Working days for {{ choice_date|date:'m/Y' }}</a></p>
        {% if work_hours %}
          <div class="row text-primary font-weight-bold font-italic">
            <div class="col-6">
              <p>Work day{{ work_hours|length|pluralize:'s' }}: {{ work_hours|length }}</p>
            </div>
            <div class="col-6">
              <p>Work hour{{ total_hours|pluralize:'s' }}: {{ total_hours|floatformat:2 }}</p>
            </div>
          </div>
          <div class="input-group">
            <div class="input-group-prepend">
              <span class="input-group-text" id="basic-addon"><img src="{% static 'images/mainboard/search.ico' %}" width="24px" alt="Search..."></span>
            </div>
            <input class="form-control" id="myInput" type="text" placeholder="Search..." aria-label="Filtering table" aria-describedby="basic-addon">
            <div class="input-group-append">
              <a class="btn btn-outline-success" href="/admin/">Admin</a>
            </div>
          </div>
          <table class="table table-hover table-sm" style="width:100%">
            <colgroup>
              <col span="1" style="width:4%">
              <col span="1" style="width:49%">
              <col span="1" style="width:10%">
              <col span="1" style="width:10%">
              <col span="1" style="width:27%">
            </colgroup>
            <thead>
              <tr class="text-dark">
                <th>Nr</th>
                <th>Data</th>
                <th class="text-center">Start</th>
                <th class="text-right">End</th>
                <th class="text-right">Hours</th>
              </tr>
            </thead>
          </table>
          <div class="table-scroll">
            <table class="table table-hover table-sm" style="width:100%">
                <colgroup>
                <col span="1" style="width:4%">
                <col span="1" style="width:49%">
                <col span="1" style="width:10%">
                <col span="1" style="width:10%">
                <col span="1" style="width:27%">
              </colgroup><tbody id="searchTable">
              {% for hours in work_hours %}
                <tr>
                  <td class="text-secondary">{{ forloop.counter }}</td>
                  {% if hours.start_work|date:'w' == '0' %}
                    <td class="text-right text-danger">{{ hours.start_work|date:'d l' }}</td>
                  {% elif hours.start_work|date:'w' == '6' %}
                    <td class="text-right text-primary">{{ hours.start_work|date:'d l' }}</td>
                  {% else %}
                    <td class="text-right">{{ hours.start_work|date:'d l' }}</td>
                  {% endif %}
                  <td class="text-success">{{ hours.start_work|time:'H:i' }}</td>
                  <td class="text-success">{{ hours.end_work|time:'H:i' }}</td>
                  <td class="text-right text-info font-weight-bold">{{ hours.jobhours|floatformat:2 }}</td>
                </tr>
              {% endfor %}
              </tbody>

            </table>
          {% else %}
          <p class="text-justify text-danger font-weight-bold font-italic">For selected date <mark>{{ choice_date|date:'m/Y' }}</mark> there aren't register working days in database. Please select another date...</p>
          {% endif %}
        </div>
      </div>

    </div>
  </div>

{% endblock %}
